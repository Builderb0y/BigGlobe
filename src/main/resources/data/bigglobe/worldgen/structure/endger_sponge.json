{
	"type": "bigglobe:script",
	"biomes": "#bigglobe:has_structure/endger_sponge",
	"spawn_overrides": {},
	"step": "raw_generation",
	"layout": [
		"int*(",
			"size        = random.nextInt(1, 5)",
			"innerType   = random.nextInt(4)",
			"outerType   = random.nextInt(4)",
			"outerRadius = 3 ^ size",
			"innerRadius = outerRadius >> 1",
			"minY        = world_traits.`bigglobe:min_y` + innerRadius",
			"maxY        = world_traits.`bigglobe:max_y` - innerRadius",
		")",
		";minY is inclusive, but maxY is exclusive.",
		";luckily, random.nextInt() treats them like this anyway.",
		"int originY = random.nextInt(minY, maxY)",
		"print('adding ender sponge of $:size at $originX $originY $originZ, $:outerRadius, $:innerRadius, $:innerType, $:outerType')",
		"void addPiece(int*(x, y, z), boolean outer:",
			"int maybeClamp(int*(min, max, value):",
				"outer ? clamp(min, max, value) : value",
			")",
			"pieces.add(",
				"ScriptStructurePiece.new(",
					"maybeClamp(originX - outerRadius, originX + outerRadius, x - innerRadius),",
					"maybeClamp(originY - outerRadius, originY + outerRadius, y - innerRadius),",
					"maybeClamp(originZ - outerRadius, originZ + outerRadius, z - innerRadius),",
					"maybeClamp(originX - outerRadius, originX + outerRadius, x + innerRadius),",
					"maybeClamp(originY - outerRadius, originY + outerRadius, y + innerRadius),",
					"maybeClamp(originZ - outerRadius, originZ + outerRadius, z + innerRadius),",
					"'bigglobe:endger_sponge',",
					"nbtCompound(",
						"x: x,",
						"y: y,",
						"z: z,",
						"scale: size.as(byte),",
						"type: (outer ? outerType : innerType).as(byte),",
						"state: outer ? 'minecraft:purpur_block' : 'minecraft:end_stone_bricks'",
					")",
				")",
			")",
		")",
		"addPiece(originX,               originY,               originZ,               false)",
		"addPiece(originX + outerRadius, originY,               originZ,               true )",
		"addPiece(originX - outerRadius, originY,               originZ,               true )",
		"addPiece(originX,               originY + outerRadius, originZ,               true )",
		"addPiece(originX,               originY - outerRadius, originZ,               true )",
		"addPiece(originX,               originY,               originZ + outerRadius, true )",
		"addPiece(originX,               originY,               originZ - outerRadius, true )"
	]
}